name: Void Lichess Bot

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  workflow_dispatch: # Manuel baÅŸlatma
  schedule:
    - cron: '0 */6 * * *' # Her 6 saatte bir otomatik baÅŸlar

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Kodlari Cek
        uses: actions/checkout@v4

      - name: Python Kurulumu
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cerebellum Kitabini Indir ve Kur
        run: |
          echo "ðŸ“š Devasa aÃ§Ä±lÄ±ÅŸ kitabÄ± indiriliyor..."
          curl -L "https://github.com/Scriptionz/Oxydan-Chess-Bot/releases/download/v1_Book/Cerebellum3Merge.zip" -o book.zip
          echo "ðŸ“‚ ZIP'ten Ã§Ä±karÄ±lÄ±yor..."
          unzip book.zip
          mv Cerebellum3Merge.bin book.bin
          echo "âœ… Kitap hazÄ±r: $(ls -lh book.bin)"

      - name: Stockfish 18 Motorunu Indir
        run: |
          echo "ðŸŒŒ VOID iÃ§in Stockfish 18 (Latest) hazÄ±rlanÄ±yor..."
          # Resmi Stockfish reposundan en son Ubuntu sÃ¼rÃ¼mÃ¼nÃ¼ Ã§ekiyoruz
          curl -L "https://github.com/official-stockfish/Stockfish/releases/latest/download/stockfish-ubuntu-x86-64-avx2.tar.gz" -o sf18.tar.gz
          
          # DosyayÄ± Ã§Ä±kartalÄ±m
          mkdir -p sf_engine
          tar -xvf sf18.tar.gz -C sf_engine
          
          # Ä°Ã§indeki Ã§alÄ±ÅŸtÄ±rÄ±labilir dosyayÄ± bul ve src/Ethereal olarak maskele
          # Bu sayede mevcut 'lichess-bot.py' kodunu hiÃ§ deÄŸiÅŸtirmene gerek kalmaz.
          find sf_engine -type f -name "stockfish*" -exec mv {} ./src/Ethereal \;
          
          chmod +x ./src/Ethereal
          echo "âœ… Stockfish 18 baÅŸarÄ±yla ./src/Ethereal konumuna yerleÅŸtirildi."

      - name: Kutuphaneleri Kur
        run: |
          pip install -r requirements.txt

      - name: Motor Test (UCI Testi)
        run: |
          chmod +x ./src/Ethereal
          echo "uci" | ./src/Ethereal | grep "uciok" || (echo "MOTOR CALISMIYOR!" && exit 1)

      - name: Botu Baslat
        env:
          LICHESS_TOKEN: ${{ secrets.LICHESS_TOKEN }}
        run: |
          # Config dosyasÄ±ndaki token yer tutucusunu gÃ¼ncelle
          sed -i "s/\$LICHESS_TOKEN/$LICHESS_TOKEN/g" config.yml || echo "Config hatasi!"
          # Botu baÅŸlat
          python -u lichess-bot.py
