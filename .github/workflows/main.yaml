name: Void Lichess Bot

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  workflow_dispatch: # Manuel baÅŸlatma
  schedule:
    - cron: '0 */6 * * *' # Her 6 saatte bir otomatik baÅŸlar

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Kodlari Cek
        uses: actions/checkout@v4

      - name: Python Kurulumu
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cerebellum Kitabini Indir ve Kur
        run: |
          echo "ğŸ“š Devasa aÃ§Ä±lÄ±ÅŸ kitabÄ± indiriliyor..."
          curl -L "https://github.com/Scriptionz/Oxydan-Chess-Bot/releases/download/v1_Book/Cerebellum3Merge.zip" -o book.zip
          echo "ğŸ“‚ ZIP'ten Ã§Ä±karÄ±lÄ±yor..."
          unzip book.zip
          mv Cerebellum3Merge.bin book.bin
          echo "âœ… Kitap hazÄ±r: $(ls -lh book.bin)"

      - name: Stockfish 18 Motorunu Kur (Garantili Link)
        run: |
          echo "ğŸŒŒ VOID uyanÄ±yor: DoÄŸrudan baÄŸlantÄ± kuruldu..."
          
          # 1. KlasÃ¶r hazÄ±rlÄ±ÄŸÄ±
          mkdir -p src
          
          # 2. Senin verdiÄŸin doÄŸrudan linkle indirme
          wget -q --show-progress "https://github.com/official-stockfish/Stockfish/releases/download/sf_18/stockfish-ubuntu-x86-64-avx2.tar" -O sf18.tar
          
          # 3. DosyanÄ±n indiÄŸini ve boyutunu kontrol et
          ls -lh sf18.tar
          
          # 4. Paketi aÃ§ (DÃ¼z .tar olduÄŸu iÃ§in -xvf kullanÄ±yoruz)
          tar -xvf sf18.tar
          
          # 5. Motoru bul ve 'Ethereal' olarak maskele
          # Not: find komutu klasÃ¶rÃ¼n iÃ§indeki o uzun isimli dosyayÄ± otomatik bulur
          find . -maxdepth 3 -type f -name "stockfish-ubuntu-x86-64-avx2" -exec mv {} ./src/Ethereal \;
          
          # 6. Ä°zinleri ver ve test et
          chmod +x ./src/Ethereal
          echo "âœ… Motor baÅŸarÄ±yla kuruldu ve maskelendi."
          ./src/Ethereal uci | grep "Stockfish 18"

      - name: Kutuphaneleri Kur
        run: |
          pip install -r requirements.txt

      - name: Motor Test (UCI Testi)
        run: |
          chmod +x ./src/Ethereal
          echo "uci" | ./src/Ethereal | grep "uciok" || (echo "MOTOR CALISMIYOR!" && exit 1)

      - name: Botu Baslat
        env:
          LICHESS_TOKEN: ${{ secrets.LICHESS_TOKEN }}
        run: |
          # Config dosyasÄ±ndaki token yer tutucusunu gÃ¼ncelle
          sed -i "s/\$LICHESS_TOKEN/$LICHESS_TOKEN/g" config.yml || echo "Config hatasi!"
          # Botu baÅŸlat
          python -u lichess-bot.py
